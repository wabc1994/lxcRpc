# 负载均衡
客户端通过服务注册中心拿到一堆地址，该调哪个呢？最简单的方式，可以通过RR、WRR的方式去做LB。
我们知道，负载均衡器在负载均衡设备中的作用是至关重要的，它起着承上启下的作用。一方面接收用户的网络请求，一方面把请求按照某种算法转接到特定的应用服务器中，实现负载均衡
如果做得更深入一些，可以从以下角度去优化：

>1. 根据服务实例的metrics做出动态调整, 比如响应时间等
>2. 利用一致性哈希， 提高本地缓存利用率
## 常见的负载均衡方法
常见的LB策略有很多：

1. RoundRobin (RR)： 一个列表中轮着来
2. WeightedRoundRobin (WRR)： 带权重的RR
3. LocalFirst：本地服务优先
4. Random：随机选择
5. ConsistentHash： 一致性哈希算法
### 为何采用一致性哈希？
在服务器数量发生变动时(增加服务器或者)，只有少数用户的请求会发送到新的机器上， 这样可以最大程度的利用服务器的本地缓存。能最大化利用已有的缓存，避免缓存失效。
>取余算法的弊端，当服务器数量发生变化的时候，缓存失效的问题
### 如何实现一致hash算法
一致性哈希算法在我看来只有两个注意点：
>1. 如何找到某一个hash值在环中的下一个节点
>2. 如何实现虚拟节点的replica(如何解决hash环倾斜的问题)

这两个问题比较好解决：
 1. 对于第一个问题， 可以利用treemap来实现
 2. 对于第二个问题， 我们只需要对某一个物理节点的key做多次的【修改key，再hash，再存入treemap中】即可
 
# 容灾
健康监测： 在某一个服务节点挂掉的时候,如何在服务注册中心删去这个服务地址？
服务调用超时与重试： 在调用一个服务实例的时候，如果超时或者报错，怎么处理？
服务限流：如何限制最大并发数？这个又可以从客户端和服务端两个角度分析。
